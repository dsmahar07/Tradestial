<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tradestial Browser Compatibility Test</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            padding: 30px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        .test-header {
            text-align: center;
            margin-bottom: 40px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            padding: 20px;
            background: #fafafa;
        }
        .test-card h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .test-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px solid #eee;
        }
        .test-item:last-child {
            border-bottom: none;
        }
        .status {
            padding: 4px 8px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
        }
        .status.pass { background: #d4edda; color: #155724; }
        .status.fail { background: #f8d7da; color: #721c24; }
        .status.pending { background: #fff3cd; color: #856404; }
        .browser-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 6px;
            margin-bottom: 20px;
        }
        .performance-chart {
            height: 200px;
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 20px 0;
        }
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
        }
        .test-button:hover {
            background: #0056b3;
        }
        .results-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 6px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-header">
            <h1>üß™ Tradestial Browser Compatibility Test Suite</h1>
            <p>Comprehensive testing across browsers and devices</p>
        </div>

        <div class="browser-info">
            <h3>Current Browser Information</h3>
            <div id="browser-details"></div>
        </div>

        <div style="text-align: center; margin: 20px 0;">
            <button class="test-button" onclick="runAllTests()">üöÄ Run All Tests</button>
            <button class="test-button" onclick="testTradestialApp()">üéØ Test Tradestial App</button>
            <button class="test-button" onclick="exportResults()">üìä Export Results</button>
        </div>

        <div class="test-grid">
            <div class="test-card">
                <h3>üåê Browser Features</h3>
                <div id="browser-features"></div>
            </div>

            <div class="test-card">
                <h3>üì± Device Capabilities</h3>
                <div id="device-capabilities"></div>
            </div>

            <div class="test-card">
                <h3>üé® CSS Features</h3>
                <div id="css-features"></div>
            </div>

            <div class="test-card">
                <h3>‚ö° Performance</h3>
                <div id="performance-tests"></div>
            </div>
        </div>

        <div class="performance-chart" id="performance-chart">
            Performance metrics will appear here
        </div>

        <div class="results-section">
            <h3>üìã Test Results Summary</h3>
            <div id="test-summary"></div>
        </div>
    </div>

    <script>
        let testResults = {
            browser: {},
            device: {},
            css: {},
            performance: {},
            tradestial: {},
            timestamp: new Date().toISOString()
        };

        // Initialize browser detection
        function detectBrowser() {
            const ua = navigator.userAgent;
            const browser = {
                name: 'Unknown',
                version: 'Unknown',
                engine: 'Unknown'
            };

            if (ua.includes('Chrome') && !ua.includes('Edg')) {
                browser.name = 'Chrome';
                browser.version = ua.match(/Chrome\/([0-9.]+)/)?.[1] || 'Unknown';
                browser.engine = 'Blink';
            } else if (ua.includes('Firefox')) {
                browser.name = 'Firefox';
                browser.version = ua.match(/Firefox\/([0-9.]+)/)?.[1] || 'Unknown';
                browser.engine = 'Gecko';
            } else if (ua.includes('Safari') && !ua.includes('Chrome')) {
                browser.name = 'Safari';
                browser.version = ua.match(/Version\/([0-9.]+)/)?.[1] || 'Unknown';
                browser.engine = 'WebKit';
            } else if (ua.includes('Edg')) {
                browser.name = 'Edge';
                browser.version = ua.match(/Edg\/([0-9.]+)/)?.[1] || 'Unknown';
                browser.engine = 'Blink';
            }

            return browser;
        }

        // Display browser information
        function displayBrowserInfo() {
            const browser = detectBrowser();
            const info = `
                <strong>Browser:</strong> ${browser.name} ${browser.version}<br>
                <strong>Engine:</strong> ${browser.engine}<br>
                <strong>Platform:</strong> ${navigator.platform}<br>
                <strong>User Agent:</strong> ${navigator.userAgent.substring(0, 100)}...
            `;
            document.getElementById('browser-details').innerHTML = info;
            testResults.browser = browser;
        }

        // Test browser features
        function testBrowserFeatures() {
            const features = [
                { name: 'Local Storage', test: () => !!window.localStorage },
                { name: 'Session Storage', test: () => !!window.sessionStorage },
                { name: 'IndexedDB', test: () => !!window.indexedDB },
                { name: 'Web Workers', test: () => !!window.Worker },
                { name: 'Service Workers', test: () => !!navigator.serviceWorker },
                { name: 'Fetch API', test: () => !!window.fetch },
                { name: 'WebGL', test: () => !!document.createElement('canvas').getContext('webgl') },
                { name: 'WebGL2', test: () => !!document.createElement('canvas').getContext('webgl2') },
                { name: 'File API', test: () => !!window.File },
                { name: 'Drag & Drop', test: () => 'draggable' in document.createElement('div') }
            ];

            let html = '';
            features.forEach(feature => {
                const result = feature.test();
                const status = result ? 'pass' : 'fail';
                html += `
                    <div class="test-item">
                        <span>${feature.name}</span>
                        <span class="status ${status}">${result ? 'PASS' : 'FAIL'}</span>
                    </div>
                `;
                testResults.browser[feature.name] = result;
            });

            document.getElementById('browser-features').innerHTML = html;
        }

        // Test device capabilities
        function testDeviceCapabilities() {
            const capabilities = [
                { name: 'Touch Support', test: () => 'ontouchstart' in window },
                { name: 'Geolocation', test: () => !!navigator.geolocation },
                { name: 'Device Motion', test: () => !!window.DeviceMotionEvent },
                { name: 'Device Orientation', test: () => !!window.DeviceOrientationEvent },
                { name: 'Camera Access', test: () => !!navigator.mediaDevices },
                { name: 'Vibration', test: () => !!navigator.vibrate },
                { name: 'Battery API', test: () => !!navigator.getBattery },
                { name: 'Network Info', test: () => !!navigator.connection }
            ];

            let html = '';
            capabilities.forEach(capability => {
                const result = capability.test();
                const status = result ? 'pass' : 'fail';
                html += `
                    <div class="test-item">
                        <span>${capability.name}</span>
                        <span class="status ${status}">${result ? 'PASS' : 'FAIL'}</span>
                    </div>
                `;
                testResults.device[capability.name] = result;
            });

            // Add screen information
            html += `
                <div class="test-item">
                    <span>Screen Resolution</span>
                    <span>${screen.width}x${screen.height}</span>
                </div>
                <div class="test-item">
                    <span>Viewport Size</span>
                    <span>${window.innerWidth}x${window.innerHeight}</span>
                </div>
            `;

            document.getElementById('device-capabilities').innerHTML = html;
        }

        // Test CSS features
        function testCSSFeatures() {
            const features = [
                { name: 'CSS Grid', test: () => CSS.supports('display', 'grid') },
                { name: 'CSS Flexbox', test: () => CSS.supports('display', 'flex') },
                { name: 'CSS Variables', test: () => CSS.supports('--test', 'value') },
                { name: 'CSS Transforms', test: () => CSS.supports('transform', 'scale(1)') },
                { name: 'CSS Animations', test: () => CSS.supports('animation', 'test 1s') },
                { name: 'CSS Transitions', test: () => CSS.supports('transition', 'all 1s') },
                { name: 'CSS Backdrop Filter', test: () => CSS.supports('backdrop-filter', 'blur(10px)') },
                { name: 'CSS Container Queries', test: () => CSS.supports('container-type', 'inline-size') }
            ];

            let html = '';
            features.forEach(feature => {
                const result = feature.test();
                const status = result ? 'pass' : 'fail';
                html += `
                    <div class="test-item">
                        <span>${feature.name}</span>
                        <span class="status ${status}">${result ? 'PASS' : 'FAIL'}</span>
                    </div>
                `;
                testResults.css[feature.name] = result;
            });

            document.getElementById('css-features').innerHTML = html;
        }

        // Test performance
        function testPerformance() {
            const tests = [
                { name: 'DOM Query Speed', test: testDOMSpeed },
                { name: 'Canvas Performance', test: testCanvasPerformance },
                { name: 'Memory Usage', test: testMemoryUsage },
                { name: 'Network Speed', test: testNetworkSpeed }
            ];

            let html = '';
            tests.forEach(async (test) => {
                try {
                    const result = await test.test();
                    const status = result.status || 'pass';
                    html += `
                        <div class="test-item">
                            <span>${test.name}</span>
                            <span class="status ${status}">${result.value}</span>
                        </div>
                    `;
                    testResults.performance[test.name] = result;
                } catch (error) {
                    html += `
                        <div class="test-item">
                            <span>${test.name}</span>
                            <span class="status fail">ERROR</span>
                        </div>
                    `;
                }
            });

            document.getElementById('performance-tests').innerHTML = html;
        }

        // Performance test functions
        function testDOMSpeed() {
            const start = performance.now();
            for (let i = 0; i < 1000; i++) {
                document.querySelector('body');
            }
            const time = performance.now() - start;
            return { value: `${time.toFixed(2)}ms`, status: time < 10 ? 'pass' : 'fail' };
        }

        function testCanvasPerformance() {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            const start = performance.now();
            
            for (let i = 0; i < 1000; i++) {
                ctx.fillRect(i % 100, i % 100, 10, 10);
            }
            
            const time = performance.now() - start;
            return { value: `${time.toFixed(2)}ms`, status: time < 50 ? 'pass' : 'fail' };
        }

        function testMemoryUsage() {
            if (performance.memory) {
                const used = (performance.memory.usedJSHeapSize / 1024 / 1024).toFixed(2);
                return { value: `${used}MB`, status: used < 50 ? 'pass' : 'fail' };
            }
            return { value: 'Not Available', status: 'pending' };
        }

        async function testNetworkSpeed() {
            try {
                const start = performance.now();
                await fetch('data:text/plain,test');
                const time = performance.now() - start;
                return { value: `${time.toFixed(2)}ms`, status: time < 100 ? 'pass' : 'fail' };
            } catch {
                return { value: 'Failed', status: 'fail' };
            }
        }

        // Test Tradestial app specifically
        async function testTradestialApp() {
            const tradestialUrl = 'http://localhost:3000';
            const tests = [
                { name: 'App Accessibility', test: () => testAppAccessibility(tradestialUrl) },
                { name: 'Page Load Time', test: () => testPageLoad(tradestialUrl) },
                { name: 'Responsive Design', test: () => testResponsiveDesign() },
                { name: 'Local Storage', test: () => testLocalStorage() }
            ];

            let results = '';
            for (const test of tests) {
                try {
                    const result = await test.test();
                    const status = result.success ? 'pass' : 'fail';
                    results += `‚úÖ ${test.name}: ${result.message}\n`;
                    testResults.tradestial[test.name] = result;
                } catch (error) {
                    results += `‚ùå ${test.name}: ${error.message}\n`;
                    testResults.tradestial[test.name] = { success: false, message: error.message };
                }
            }

            alert(`Tradestial App Test Results:\n\n${results}`);
        }

        async function testAppAccessibility(url) {
            try {
                const response = await fetch(url);
                return { 
                    success: response.ok, 
                    message: response.ok ? 'App is accessible' : 'App not accessible' 
                };
            } catch {
                return { success: false, message: 'Cannot reach app' };
            }
        }

        async function testPageLoad(url) {
            const start = performance.now();
            try {
                await fetch(url);
                const time = performance.now() - start;
                return { 
                    success: time < 3000, 
                    message: `Loaded in ${time.toFixed(2)}ms` 
                };
            } catch {
                return { success: false, message: 'Failed to load' };
            }
        }

        function testResponsiveDesign() {
            const width = window.innerWidth;
            const isMobile = width < 768;
            const isTablet = width >= 768 && width < 1024;
            const isDesktop = width >= 1024;
            
            return { 
                success: true, 
                message: `${isMobile ? 'Mobile' : isTablet ? 'Tablet' : 'Desktop'} layout (${width}px)` 
            };
        }

        function testLocalStorage() {
            try {
                localStorage.setItem('test', 'value');
                const value = localStorage.getItem('test');
                localStorage.removeItem('test');
                return { 
                    success: value === 'value', 
                    message: 'Local storage working' 
                };
            } catch {
                return { success: false, message: 'Local storage blocked' };
            }
        }

        // Run all tests
        function runAllTests() {
            displayBrowserInfo();
            testBrowserFeatures();
            testDeviceCapabilities();
            testCSSFeatures();
            testPerformance();
            
            setTimeout(() => {
                updateTestSummary();
            }, 1000);
        }

        // Update test summary
        function updateTestSummary() {
            const total = Object.keys(testResults.browser).length + 
                         Object.keys(testResults.device).length + 
                         Object.keys(testResults.css).length;
            
            const passed = Object.values(testResults.browser).filter(Boolean).length +
                          Object.values(testResults.device).filter(Boolean).length +
                          Object.values(testResults.css).filter(Boolean).length;

            const summary = `
                <strong>Total Tests:</strong> ${total}<br>
                <strong>Passed:</strong> ${passed}<br>
                <strong>Failed:</strong> ${total - passed}<br>
                <strong>Success Rate:</strong> ${((passed / total) * 100).toFixed(1)}%<br>
                <strong>Browser:</strong> ${testResults.browser.name} ${testResults.browser.version}
            `;

            document.getElementById('test-summary').innerHTML = summary;
        }

        // Export results
        function exportResults() {
            const dataStr = JSON.stringify(testResults, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = `tradestial-test-results-${new Date().toISOString().split('T')[0]}.json`;
            link.click();
        }

        // Initialize on page load
        window.addEventListener('load', () => {
            runAllTests();
        });
    </script>
</body>
</html>
